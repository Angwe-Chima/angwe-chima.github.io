import{r as l,j as e,m as j,e as k,a2 as E}from"./index-Nnme1ILz.js";import{u as F,I as y}from"./Input-DaiDae5B.js";import{r as U,u as T,c as C}from"./galleryService-Cdj5SRQF.js";import{u as G}from"./uploadService-CZVGdzxx.js";import{T as O}from"./Textarea-tXh7MUqa.js";import{B as v}from"./Button-DcKssBXq.js";import{A as R}from"./index-B5J0J5mJ.js";const M=({image:t,onClose:i})=>{const[u,p]=l.useState(!1),[h,f]=l.useState(!1),[g,m]=l.useState(""),[r,n]=l.useState([]),[b,x]=l.useState(null),{register:o,handleSubmit:N,formState:{errors:I},setValue:_}=F({defaultValues:t||{title:"",description:"",category:"Other",order:0,featured:!1}});l.useEffect(()=>(document.body.style.overflow="hidden",t&&n(t.imageUrls||[]),()=>{document.body.style.overflow="unset"}),[t]);const w=async s=>{const a=s.target.files[0];if(a)try{f(!0);const c=await G(a);n([...r,c.url])}catch{alert("Failed to upload image")}finally{f(!1)}},P=async s=>{if(t&&window.confirm("Remove this image?"))try{x(s),await U(t._id,s);const a=r.filter((c,d)=>d!==s);n(a)}catch{alert("Failed to remove image")}finally{x(null)}else if(!t){const a=r.filter((c,d)=>d!==s);n(a)}},S=async s=>{try{if(p(!0),m(""),r.length===0){m("Please upload at least one image");return}const a={...s,imageUrls:r};t?await T(t._id,a):await C(a),i()}catch(a){m(a.response?.data?.message||"Failed to save post")}finally{p(!1)}};return e.jsx(R,{children:e.jsx("div",{className:"modal-overlay",onClick:i,children:e.jsxs(j.div,{className:"gallery-form-modal",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:t?"Edit Gallery Post":"Create New Gallery Post"}),e.jsx("button",{onClick:i,className:"modal-close-btn",children:e.jsx(k,{size:20})})]}),e.jsxs("form",{onSubmit:N(S),className:"gallery-form",children:[e.jsx(y,{label:"Title",name:"title",placeholder:"Working on Project",register:o,error:I.title,required:!0}),e.jsx(O,{label:"Description (optional)",name:"description",placeholder:"Tell the story behind these images...",rows:3,register:o}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsxs("select",{...o("category"),className:"form-select",children:[e.jsx("option",{value:"Work",children:"Work"}),e.jsx("option",{value:"Personal",children:"Personal"}),e.jsx("option",{value:"Events",children:"Events"}),e.jsx("option",{value:"Travel",children:"Travel"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsx(y,{label:"Order",name:"order",type:"number",placeholder:"0",register:o}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",...o("featured")}),e.jsx("span",{children:"Featured Post"})]})}),e.jsxs("div",{className:"images-section",children:[e.jsxs("label",{children:["Gallery Images (",r.length,")"]}),e.jsxs("div",{className:"upload-area",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:s=>{Array.from(s.target.files||[]).forEach(a=>{w({target:{files:[a]}})})},disabled:h,className:"file-input"}),e.jsxs("div",{className:"upload-placeholder",children:[e.jsx("p",{children:"Drag and drop images here or click to select"}),h&&e.jsx("p",{className:"uploading",children:"Uploading..."})]})]}),r.length>0&&e.jsx("div",{className:"images-grid",children:r.map((s,a)=>e.jsxs(j.div,{className:"image-item",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},children:[e.jsx("img",{src:s,alt:`Preview ${a+1}`}),e.jsx("button",{type:"button",onClick:()=>P(a),disabled:b===a,className:"remove-image-btn",children:e.jsx(E,{size:14})}),e.jsx("span",{className:"image-number",children:a+1})]},a))})]}),g&&e.jsx("p",{className:"error-text",children:g}),e.jsxs("div",{className:"form-actions",children:[e.jsx(v,{type:"button",variant:"secondary",onClick:i,children:"Cancel"}),e.jsx(v,{type:"submit",variant:"primary",disabled:u,children:u?"Saving...":t?"Update Post":"Create Post"})]})]})]})})})};export{M as default};
